<header class="hero">
  <div class="container hero-inner">
    <nav class="topbar shadow-soft">
      <div class="brand" routerLink="/" aria-label="RecipeBerry Home">
        <span class="brand-mark" aria-hidden="true">РЌЈ</span>
        <span class="brand-name">RE<span class="accent">CIPE</span></span>
      </div>
      <div class="actions">
        <a class="btn btn-outline" routerLink="/">Рєљ Back</a>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <section class="form-card shadow-soft">
    <h1 class="title">Add a New Recipe</h1>
    <p class="subtitle">рЃерЃћрЃљрЃЋрЃАрЃћ рЃЦрЃЋрЃћрЃЏрЃЮрЃЌ рЃЏрЃЮрЃфрЃћрЃЏрЃБрЃџрЃў рЃЋрЃћрЃџрЃћрЃЉрЃў. *-рЃўрЃЌ рЃЏрЃЮрЃюрЃўрЃерЃюрЃБрЃџрЃў рЃЋрЃћрЃџрЃћрЃЉрЃў рЃАрЃљрЃЋрЃљрЃџрЃЊрЃћрЃЉрЃБрЃџрЃЮрЃљ.</p>

    <!-- submit -> trySubmit -->
    <form [formGroup]="form" (ngSubmit)="trySubmit()" novalidate>
      <div class="grid-2">
        <!-- LEFT COLUMN -->
        <div class="stack">
          <!-- Basics -->
          <h2 class="section-title">Basics</h2>
          <p class="section-hint">рЃЊрЃљрЃљрЃгрЃћрЃарЃћ рЃЏрЃЎрЃљрЃцрЃўрЃЮ рЃАрЃљрЃ«рЃћрЃџрЃў рЃЊрЃљ рЃЏрЃЮрЃЎрЃџрЃћ рЃљрЃдрЃгрЃћрЃарЃљ Рђћ рЃарЃљрЃА рЃљрЃЏрЃќрЃљрЃЊрЃћрЃЉ рЃЊрЃљ рЃарЃљ рЃљрЃЦрЃЋрЃА рЃњрЃљрЃюрЃАрЃљрЃЎрЃБрЃЌрЃарЃћрЃЉрЃБрЃџрЃў.</p>

          <label class="field">
            <span>Title *</span>
            <input type="text" formControlName="title" placeholder="e.g. Zesty Chicken Salad" />
            <small class="err" *ngIf="fieldInvalid('title')">Please enter a title (min 3 characters).</small>
          </label>

          <label class="field">
            <span>Description *</span>
            <textarea formControlName="description" rows="3" placeholder="Short summary Рђћ flavor, texture, when to serveРђд"></textarea>
            <small class="err" *ngIf="fieldInvalid('description')">Please enter a description (min 10 characters).</small>
          </label>

          <!-- Ingredients -->
          <h2 class="section-title">Ingredients</h2>
          <p class="section-hint">рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃћ рЃўрЃюрЃњрЃарЃћрЃЊрЃўрЃћрЃюрЃбрЃў рЃЊрЃљ рЃЊрЃљрЃљрЃГрЃўрЃарЃћ Enter-рЃА (рЃљрЃю рЃЊрЃљрЃбрЃЮрЃЋрЃћ рЃЋрЃћрЃџрЃў, рЃарЃЮрЃЏ рЃЊрЃљрЃћрЃЏрЃљрЃбрЃЮрЃА).</p>

          <div class="field">
            <span>Ingredients *</span>
            <div class="chips">
              <input type="text" placeholder="e.g. 200g chicken, 1 tbsp mayo, dillРђд"
                     (keydown.enter)="$event.preventDefault(); addFromInput($event, 'ingredients')"
                     (blur)="addFromInput($event, 'ingredients')" />
              <div class="chip" *ngFor="let ing of ingredientsArr.controls; index as i">
                <span>{{ ing.value }}</span>
                <button type="button" class="x" (click)="removeChip('ingredients', i)" aria-label="Remove">РюЋ</button>
              </div>
            </div>
            <small class="err" *ngIf="ingredientsArr.invalid && ingredientsArr.touched">Please add at least one ingredient.</small>
          </div>

          <!-- Steps -->
          <h2 class="section-title">Steps</h2>
          <p class="section-hint">рЃЊрЃљрЃгрЃћрЃарЃћ рЃюрЃљрЃЉрЃўрЃ»-рЃюрЃљрЃЉрЃўрЃ» Рђћ 1) рЃЏрЃЮрЃЏрЃќрЃљрЃЊрЃћрЃЉрЃљ, 2) рЃерЃћрЃарЃћрЃЋрЃљ, 3) рЃЏрЃЮрЃ«рЃљрЃарЃерЃЋрЃљ/рЃфрЃ«рЃЮрЃЉрЃљ, 4) рЃЏрЃўрЃбрЃљрЃюрЃљ.</p>

          <label class="field">
            <span>Instructions *</span>
            <textarea formControlName="instructions" rows="6" placeholder="1) PrepРђд 2) MixРђд 3) CookРђд 4) ServeРђд"></textarea>
            <small class="err" *ngIf="fieldInvalid('instructions')">Please provide instructions (min 15 characters).</small>
          </label>

          <!-- Meta -->
          <h2 class="section-title">Meta</h2>
          <p class="section-hint">рЃЊрЃарЃЮ/рЃърЃЮрЃарЃбрЃўрЃЮрЃюрЃћрЃЉрЃў рЃљрЃарЃЕрЃћрЃЋрЃўрЃЌрЃўрЃљ. рЃАрЃўрЃарЃЌрЃБрЃџрЃћ рЃљрЃљрЃарЃЕрЃўрЃћ рЃњрЃћрЃЏрЃЮрЃфрЃюрЃћрЃЉрЃўрЃЌ.</p>

          <div class="grid-3">
            <label class="field">
              <span>Time (min)</span>
              <input type="number" formControlName="timeMinutes" min="1" placeholder="e.g. 20" />
              <small class="err" *ngIf="fieldInvalid('timeMinutes')">Value must be РЅЦ 1.</small>
            </label>

            <label class="field">
              <span>Servings</span>
              <input type="number" formControlName="servings" min="1" placeholder="e.g. 2" />
              <small class="err" *ngIf="fieldInvalid('servings')">Value must be РЅЦ 1.</small>
            </label>

            <label class="field">
              <span>Difficulty</span>
              <select formControlName="difficulty">
                <option value="">Рђћ</option>
                <option value="Easy">Easy</option>
                <option value="Medium">Medium</option>
                <option value="Hard">Hard</option>
              </select>
            </label>
          </div>

          <!-- Rating (Stars) -->
          <h2 class="section-title">Rating</h2>
          <p class="section-hint">рЃЮрЃюрЃџрЃљрЃўрЃю рЃЦрЃљрЃарЃЊрЃќрЃћрЃф рЃњрЃљрЃЏрЃЮрЃЕрЃюрЃЊрЃћрЃЉрЃљ. рЃЏрЃЮрЃюрЃўрЃерЃюрЃћ 1РђЊ5 рЃЋрЃљрЃарЃАрЃЎрЃЋрЃџрЃљрЃЋрЃў.</p>

          <div class="field">
            <span>Rate this recipe</span>
            <div class="stars" role="radiogroup" aria-label="Recipe rating">
              <button
                *ngFor="let s of [1,2,3,4,5]"
                type="button"
                class="star-btn"
                role="radio"
                [attr.aria-label]="s + ' stars'"
                [attr.aria-checked]="ratingCtrl.value === s"
                [class.active]="(hoveredRating || ratingCtrl.value) >= s"
                (mouseenter)="hoverRating(s)"
                (mouseleave)="hoverRating(0)"
                (click)="setRating(s)">
                РўЁ
              </button>
              <span class="count">{{ ratingCtrl.value }}/5</span>
            </div>
            <small class="err" *ngIf="fieldInvalid('rating')">Select 0РђЊ5 stars.</small>
          </div>

          <!-- Tags -->
          <h2 class="section-title">Tags</h2>
          <p class="section-hint">рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћ рЃФрЃўрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА: #salad, #quick, #healthyРђд</p>

          <div class="field">
            <span>Tags</span>
            <div class="chips">
              <input type="text" placeholder="Press Enter to add tag"
                     (keydown.enter)="$event.preventDefault(); addFromInput($event, 'tags')"
                     (blur)="addFromInput($event, 'tags')" />
              <div class="chip" *ngFor="let tag of tagsArr.controls; index as i">
                <span>#{{ tag.value }}</span>
                <button type="button" class="x" (click)="removeChip('tags', i)" aria-label="Remove">РюЋ</button>
              </div>
            </div>
          </div>

          <!-- Author -->
          <h2 class="section-title">Author</h2>
          <p class="section-hint">рЃАрЃБрЃарЃЋрЃўрЃџрЃўрЃАрЃљрЃЏрЃћрЃЉрЃа рЃЏрЃўрЃБрЃЌрЃўрЃЌрЃћ рЃљрЃЋрЃбрЃЮрЃарЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў рЃЊрЃљ рЃљрЃЋрЃљрЃбрЃљрЃарЃў.</p>

          <div class="grid-2 compact">
            <label class="field">
              <span>Author name</span>
              <input type="text" formControlName="authorName" placeholder="e.g. Keti" />
            </label>
            <label class="field">
              <span>Author avatar URL</span>
              <input type="url" formControlName="authorAvatar" placeholder="https://..." />
            </label>
          </div>

          <label class="check">
            <input type="checkbox" formControlName="isFavorite" />
            <span>Mark as favorite</span>
          </label>
        </div>

        <!-- RIGHT COLUMN: MEDIA (Upload only) -->
        <div class="stack">
          <h2 class="section-title">Media</h2>
          <p class="section-hрЃўрЃюt">рЃљрЃбрЃЋрЃўрЃарЃЌрЃћ рЃцрЃЮрЃбрЃЮ Drag & Drop-рЃўрЃЌ рЃљрЃю рЃЊрЃљрЃљрЃЎрЃџрЃўрЃЎрЃћ рЃЋрЃћрЃџрЃА.</p>

          <div class="dropzone" (drop)="onDrop($event)" (dragover)="onDragOver($event)">
            <input type="file" accept="image/*" (change)="onFileSelected($event)" />
            <div class="dz-inner">
              <div class="emoji">­Ъќ╝№ИЈ</div>
              <p>Drag & drop an image here or click to upload</p>
              <small>WeРђЎll store it as data URL for the demo</small>
            </div>
          </div>

          <div class="preview" *ngIf="thumbPreview || thumbnailCtrl.value">
            <img [src]="thumbPreview || thumbnailCtrl.value" alt="Preview" />
          </div>
        </div>
      </div>
  <div class="actions">
    <!-- Cancel now opens confirmation popup -->
    <button type="button" class="btn btn-ghost" (click)="tryCancel()">Cancel</button>

    <!-- Submit triggers trySubmit() through (ngSubmit) -->
    <button class="btn btn-primary shiny cta" type="submit" [disabled]="form.invalid">
      <span>Create Recipe</span>
      <svg class="arrow" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
        <path d="M5 12h12M13 6l6 6-6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>
    </form>
  </section>
</main>

<app-pop-up
  [open]="showInvalidPop"
  mode="confirm"
  title="рЃњрЃЌрЃ«рЃЮрЃЋ рЃерЃћрЃљрЃЋрЃАрЃЮ рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃћрЃџрЃў рЃЋрЃћрЃџрЃћрЃЉрЃў"
  [message]="missingFields?.length ? ('рЃљрЃЎрЃџрЃўрЃљ: ' + missingFields.join(', ')) : 'рЃерЃћрЃљрЃЋрЃАрЃћ *-рЃўрЃЌ рЃЏрЃЮрЃюрЃўрЃерЃюрЃБрЃџрЃў рЃЋрЃћрЃџрЃћрЃЉрЃў.'"
  confirmText="рЃњрЃљрЃАрЃљрЃњрЃћрЃЉрЃўрЃљ"
  cancelText="рЃЊрЃљрЃ«рЃБрЃарЃЋрЃљ"
  (confirm)="onInvalidClose()"
  (cancel)="onInvalidClose()"
></app-pop-up>

<!-- 2) SAVE PopUp -->
<app-pop-up
  [open]="showSavePop"
  mode="save"
  title="рЃерЃћрЃюрЃљрЃ«рЃЋрЃљ?"
  message="рЃЊрЃљрЃарЃгрЃЏрЃБрЃюрЃћрЃЉрЃБрЃџрЃў рЃ«рЃљрЃа, рЃарЃЮрЃЏ рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў рЃАрЃгрЃЮрЃарЃўрЃљ рЃЊрЃљ рЃњрЃАрЃБрЃарЃА рЃерЃћрЃюрЃљрЃ«рЃЋрЃљ?"
  confirmText="рЃЊрЃўрЃљрЃ«, рЃерЃћрЃўрЃюрЃљрЃ«рЃћ"
  cancelText="рЃњрЃљрЃБрЃЦрЃЏрЃћрЃЉрЃљ"
  (confirm)="onSaveConfirm()"
  (cancel)="onSaveCancel()"
></app-pop-up>

<!-- 3) CANCEL PopUp: warn about clearing -->
<app-pop-up
  [open]="showCancelPop"
  mode="confirm"
  title="рЃњрЃљрЃБрЃЦрЃЏрЃћрЃЉрЃљ?"
  message="рЃњрЃљрЃБрЃЦрЃЏрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў рЃерЃћрЃўрЃЋрЃАрЃЮ рЃДрЃЋрЃћрЃџрЃљ рЃЋрЃћрЃџрЃў рЃгрЃљрЃўрЃерЃџрЃћрЃЉрЃљ. рЃњрЃљрЃЋрЃљрЃњрЃарЃФрЃћрЃџрЃЮрЃЌ?"
  confirmText="рЃЊрЃўрЃљрЃ«, рЃњрЃљрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћ"
  cancelText="рЃЊрЃљрЃарЃЕрЃћрЃюрЃљ"
  (confirm)="onCancelFlowConfirm()"
  (cancel)="onCancelFlowCancel()"
></app-pop-up>