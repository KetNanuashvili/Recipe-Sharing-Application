<header class="hero">
  <div class="container hero-inner">
    <!-- Sticky/blur topbar -->
    <nav class="topbar shadow-soft">
      <div class="brand" aria-label="RecipeBerry Home" routerLink="/">
        <span class="brand-mark" aria-hidden="true">‚óè</span>
        <span class="brand-name">RECIPE<span class="accent">BERRY</span></span>
      </div>

      <div class="actions">
        <a class="btn btn-outline" routerLink="/add" aria-label="Add new recipe">+ Add Recipe</a>
      </div>
    </nav>

    <div class="controls">
      <!-- Search -->
      <div class="search shadow-soft round-12" role="search">
        <span class="search-icon" aria-hidden="true">üîé</span>

        <input
          #searchBox
          type="text"
          [ngModel]="query()"
          (ngModelChange)="debouncedRefresh($event)"
          placeholder="Search by title or ingredient‚Ä¶ ( / )"
          aria-label="Search recipes"
        />

        <button
          class="clear"
          type="button"
          *ngIf="query()"
          (click)="clearSearch()"
          aria-label="Clear search"
          title="Clear"
        >
          ‚úï
        </button>
      </div>

      <!-- Filters -->
      <div class="filters">
        <label class="chip" title="Show only favorites">
          <input
            type="checkbox"
            [ngModel]="onlyFavorites()"
            (ngModelChange)="onlyFavorites.set($event); refresh()"
            aria-label="Favorites only"
          />
          <span>Favorites only</span>
        </label>

        <label class="select-wrap" aria-label="Sort recipes">
          <select [ngModel]="sortBy()" (ngModelChange)="sortBy.set($event)" aria-label="Sort by">
            <option value="new">Newest</option>
            <option value="title">Title A‚ÜíZ</option>
            <option value="fav">Favorites first</option>
          </select>
          <span class="caret" aria-hidden="true">‚ñæ</span>
        </label>
      </div>
    </div>
  </div>
</header>

<main class="container">
  <!-- Skeleton while loading -->
  <section class="grid" *ngIf="loading(); else content">
    <div class="card skeleton" *ngFor="let _ of [1,2,3,4,5,6,7,8]"></div>
  </section>

  <ng-template #content>
    <!-- Cards -->
    <section class="grid" *ngIf="filtered().length; else emptyState">
      <article class="card pro shadow-soft" *ngFor="let r of filtered(); trackBy: trackById">
        <!-- THUMB -->
        <div class="thumb-wrap">
          <img
            class="thumb"
            [src]="r.thumbnail || placeholder"
            [alt]="r.title"
            loading="lazy"
            (error)="onImgError($event)"
          />

          <div class="thumb-glow"></div>

          <!-- top-left chips -->
          <div class="top-chips">
            <span class="chip-soft" *ngIf="r.timeMinutes as t">‚è± {{ t }}m</span>
            <span class="chip-soft" *ngIf="r.servings as s">üçΩÔ∏è {{ s }}</span>
            <span class="chip-soft" *ngIf="r.difficulty as d">‚öôÔ∏è {{ d }}</span>
          </div>

          <!-- top-right badge -->
          <div class="badge" [class.gray]="!r.isFavorite">
            {{ r.isFavorite ? 'favorite' : 'recipe' }}
          </div>

          <!-- bottom overlay -->
          <div class="thumb-overlay">
            <h3 class="title">{{ r.title }}</h3>
            <div class="rating" *ngIf="r.rating as rate">
              <span class="star" [class.active]="rate>=1">‚òÖ</span>
              <span class="star" [class.active]="rate>=2">‚òÖ</span>
              <span class="star" [class.active]="rate>=3">‚òÖ</span>
              <span class="star" [class.active]="rate>=4">‚òÖ</span>
              <span class="star" [class.active]="rate>=5">‚òÖ</span>
            </div>
          </div>
        </div>

        <!-- CONTENT -->
        <div class="content">
          <p class="desc">{{ r.description }}</p>

          <div class="tags" *ngIf="r.tags?.length">
            <a class="tag" *ngFor="let tag of r.tags" (click)="debouncedRefresh(tag)">
              #{{ tag }}
            </a>
          </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
          <div class="author" *ngIf="r.author?.name">
            <img class="avatar" [src]="r.author?.avatar || 'https://i.pravatar.cc/64?img=8'" alt="" />
            <span class="name">{{ r.author?.name }}</span>
          </div>

          <div class="actions">
            <button
              type="button"
              class="icon-btn"
              (click)="toggleFavorite(r)"
              [attr.aria-pressed]="r.isFavorite"
              [class.active]="r.isFavorite"
              title="{{ r.isFavorite ? 'Unfavorite' : 'Favorite' }}"
            >
              <span class="icon">‚òÖ</span>
            </button>

            <!-- prettier View button -->
            <a class="btn btn-primary cta shiny" [routerLink]="['/recipes', r.id]">
              <span>View</span>
              <svg class="arrow" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <path d="M5 12h12M13 6l6 6-6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          </div>
        </div>
      </article>
    </section>

    <!-- Empty state -->
    <ng-template #emptyState>
      <div class="empty">
        <div class="emoji" aria-hidden="true">ü•£</div>
        <h2>No recipes found</h2>
        <p>Try adjusting filters or add a new recipe.</p>
        <a class="btn btn-primary shiny" routerLink="/add">Add Recipe</a>
      </div>
    </ng-template>
  </ng-template>
</main>
